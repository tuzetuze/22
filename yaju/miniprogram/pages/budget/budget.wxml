<view class="container">
  <!-- ç®€åŒ–é¢„ç®—æ¦‚è§ˆ -->
  <view class="budget-overview-card">
    <view class="budget-header">
      <text class="page-title">é¢„ç®—ç®¡ç†</text>
      <text class="page-subtitle">ç®€å•æ¸…æ™°çš„é¢„ç®—è·Ÿè¸ª</text>
    </view>
    
    <!-- æ ¸å¿ƒé¢„ç®—ä¿¡æ¯ -->
    <view class="budget-main">
      <view class="budget-total">
        <text class="budget-label">æ€»é¢„ç®—</text>
        <text class="budget-amount">ï¿¥{{totalBudget || 0}}</text>
        <button class="btn-edit" bindtap="setBudget" wx:if="{{totalBudget === 0}}">è®¾ç½®é¢„ç®—</button>
        <button class="btn-edit" bindtap="setBudget" wx:else>ä¿®æ”¹</button>
      </view>
      
      <view class="budget-usage" wx:if="{{totalBudget > 0}}">
        <view class="usage-bar">
          <view class="usage-fill" style="width: {{usagePercentage > 100 ? 100 : usagePercentage}}%;"></view>
        </view>
        <view class="usage-info">
          <text class="usage-text">å·²ç”¨ ï¿¥{{usedBudget}} / å‰©ä½™ ï¿¥{{remainingBudget}}</text>
          <text class="usage-percent">{{usagePercentage}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆ¿é—´é¢„ç®—åˆ—è¡¨ -->
  <view class="spaces-budget" wx:if="{{totalBudget > 0}}">
    <text class="section-title">å„æˆ¿é—´é¢„ç®—</text>
    
    <view class="space-list" wx:if="{{spaceBudgets.length > 0}}">
      <view 
        class="space-item"
        wx:for="{{spaceBudgets}}"
        wx:key="id"
      >
        <view class="space-info">
          <text class="space-icon">{{item.icon}}</text>
          <text class="space-name">{{item.name}}</text>
        </view>
        <view class="space-budget">
          <text class="budget-text">ï¿¥{{item.budget}}</text>
          <view class="mini-progress" wx:if="{{item.budget > 0}}">
            <view class="mini-fill" style="width: {{item.percentage > 100 ? 100 : item.percentage}}%;"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-hint" wx:else>
      <text class="hint-icon">ğŸ </text>
      <text class="hint-text">å»æˆ¿é—´é¡µé¢è®¾ç½®å„æˆ¿é—´é¢„ç®—</text>
    </view>
  </view>

  <!-- ç®€å•æç¤º -->
  <view class="simple-tip" wx:if="{{totalBudget === 0}}">
    <view class="tip-content">
      <text class="tip-icon">ğŸ’¡</text>
      <text class="tip-text">å…ˆè®¾ç½®æ€»é¢„ç®—ï¼Œå†åˆ†é…å„æˆ¿é—´é¢„ç®—ï¼Œè½»æ¾ç®¡ç†è£…ä¿®èŠ±è´¹</text>
    </view>
  </view>
</view>

<!-- è®¾ç½®é¢„ç®—å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showBudgetModal}}" catchtap="closeBudgetModal">
  <view class="modal" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="title-medium">{{totalBudget === 0 ? 'è®¾ç½®é¢„ç®—' : 'ä¿®æ”¹é¢„ç®—'}}</text>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">è£…ä¿®æ€»é¢„ç®— (å…ƒ)</text>
        <input 
          class="input-field" 
          type="digit" 
          placeholder="è¯·è¾“å…¥é¢„ç®—é‡‘é¢"
          value="{{tempBudget}}"
          bindinput="onBudgetInput"
          maxlength="10"
          confirm-type="done"
          cursor-spacing="10"
          selection-start="-1"
          selection-end="-1"
        />
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-secondary" bindtap="closeBudgetModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="confirmBudget">ç¡®å®š</button>
    </view>
  </view>
</view>