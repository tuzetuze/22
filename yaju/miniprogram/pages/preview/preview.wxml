<view class="container">
  <!-- 3Dé¢„è§ˆå¤´éƒ¨ -->
  <view class="preview-header">
    <view class="header-content">
      <text class="preview-title">ğŸ  3Då®¶å±…é¢„è§ˆ</text>
      <text class="preview-subtitle">æ²‰æµ¸å¼ä½“éªŒæ‚¨çš„ç†æƒ³å®¶å±…</text>
    </view>
    <view class="view-controls">
      <button class="control-btn {{viewMode === '3d' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="3d">
        <text class="control-icon">ğŸ›ï¸</text>
        <text class="control-text">3Dè§†å›¾</text>
      </button>
      <button class="control-btn {{viewMode === 'plan' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="plan">
        <text class="control-icon">ğŸ“</text>
        <text class="control-text">å¹³é¢å›¾</text>
      </button>
    </view>
  </view>

  <!-- 3Dæˆ¿å±‹æ¨¡å‹åŒºåŸŸ -->
  <view class="house-3d-container">
    <view class="house-model" style="transform: {{houseTransform}};">
      
      <!-- æˆ¿å±‹å¤–æ¡† -->
      <view class="house-frame">
        <view class="house-wall wall-front"></view>
        <view class="house-wall wall-back"></view>
        <view class="house-wall wall-left"></view>
        <view class="house-wall wall-right"></view>
        <view class="house-floor"></view>
        <view class="house-ceiling"></view>
      </view>

      <!-- å„ä¸ªæˆ¿é—´3Dæ•ˆæœ -->
      <view class="rooms-3d">
        <view 
          class="room-3d {{item.completed ? 'completed' : 'pending'}}"
          wx:for="{{rooms3D}}"
          wx:key="id"
          style="{{item.position}}; {{item.size}};"
          bindtap="focusRoom"
          data-room="{{item.id}}"
        >
          <!-- æˆ¿é—´åœ°æ¿ -->
          <view class="room-floor" style="background: {{item.floorColor}};"></view>
          
          <!-- æˆ¿é—´å¢™é¢ -->
          <view class="room-walls">
            <view class="room-wall wall-front" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-back" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-left" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-right" style="background: {{item.wallColor}};"></view>
          </view>

          <!-- æˆ¿é—´å®¶å…·(ç®€åŒ–3Dæ•ˆæœ) -->
          <view class="room-furniture">
            <view 
              class="furniture-item furniture-{{furnitureItem.type}}"
              wx:for="{{item.furniture}}"
              wx:key="id"
              wx:for-item="furnitureItem"
              style="{{furnitureItem.position}}; {{furnitureItem.style}};"
            >
              <text class="furniture-icon">{{furnitureItem.icon}}</text>
            </view>
          </view>

          <!-- æˆ¿é—´æ ‡ç­¾ -->
          <view class="room-label">
            <text class="room-name">{{item.name}}</text>
            <text class="room-status">{{item.completed ? 'å·²è§„åˆ’' : 'æœªè§„åˆ’'}}</text>
          </view>
        </view>
      </view>

      <!-- æˆ¿å±‹è£…é¥°æ•ˆæœ -->
      <view class="house-decorations">
        <!-- çª—æˆ· -->
        <view class="window window-1"></view>
        <view class="window window-2"></view>
        <view class="window window-3"></view>
        
        <!-- é—¨ -->
        <view class="door main-door"></view>
      </view>
    </view>

    <!-- 3Dæ§åˆ¶é¢æ¿ -->
    <view class="control-panel">
      <view class="rotation-controls">
        <button class="rotate-btn" bindtap="rotateHouse" data-direction="left">â†»</button>
        <text class="control-label">æ—‹è½¬è§†è§’</text>
        <button class="rotate-btn" bindtap="rotateHouse" data-direction="right">â†º</button>
      </view>
      <view class="zoom-controls">
        <button class="zoom-btn" bindtap="zoomHouse" data-action="out">âˆ’</button>
        <text class="control-label">ç¼©æ”¾</text>
        <button class="zoom-btn" bindtap="zoomHouse" data-action="in">+</button>
      </view>
    </view>
  </view>

  <!-- æˆ¿é—´è¯¦æƒ…é¢æ¿ -->
  <view class="room-details-panel" wx:if="{{selectedRoom}}">
    <view class="panel-header">
      <view class="room-info">
        <text class="room-icon">{{selectedRoom.icon}}</text>
        <view class="room-text">
          <text class="room-title">{{selectedRoom.name}}</text>
          <text class="room-desc">{{selectedRoom.description}}</text>
        </view>
      </view>
      <button class="close-btn" bindtap="closeRoomPanel">Ã—</button>
    </view>
    
    <view class="panel-content">
      <!-- æˆ¿é—´é¢„ç®— -->
      <view class="detail-item">
        <text class="detail-label">ğŸ’° é¢„ç®—</text>
        <text class="detail-value">ï¿¥{{selectedRoom.budget || 0}}</text>
      </view>
      
      <!-- è£…ä¿®é£æ ¼ -->
      <view class="detail-item" wx:if="{{selectedRoom.style}}">
        <text class="detail-label">ğŸ¨ é£æ ¼</text>
        <text class="detail-value">{{selectedRoom.style}}</text>
      </view>
      
      <!-- ä¸»è¦ç‰¹è‰² -->
      <view class="detail-item" wx:if="{{selectedRoom.features && selectedRoom.features.length > 0}}">
        <text class="detail-label">âœ¨ ç‰¹è‰²</text>
        <view class="features-tags">
          <text 
            class="feature-tag"
            wx:for="{{selectedRoom.features}}"
            wx:key="*this"
          >{{item}}</text>
        </view>
      </view>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <view class="quick-actions">
        <button class="action-btn" bindtap="editRoom" data-room="{{selectedRoom.id}}">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">ç¼–è¾‘</text>
        </button>
        <button class="action-btn" bindtap="viewRoomItems" data-room="{{selectedRoom.id}}">
          <text class="action-icon">ğŸ“‹</text>
          <text class="action-text">æ¸…å•</text>
        </button>
      </view>
    </view>
  </view>

  <!-- æ•´ä½“ç»Ÿè®¡ -->
  <view class="house-stats">
    <view class="stat-item">
      <text class="stat-label">æ€»é¢„ç®—</text>
      <text class="stat-value">ï¿¥{{totalBudget}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">å·²è§„åˆ’</text>
      <text class="stat-value">{{completedRooms}}/{{totalRooms}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">å®Œæˆåº¦</text>
      <text class="stat-value">{{Math.round(completedRooms/totalRooms*100)}}%</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="preview-actions">
    <button class="btn btn-secondary" bindtap="generateReport">
      ğŸ“Š ç”ŸæˆæŠ¥å‘Š
    </button>
    <button class="btn btn-secondary" bindtap="saveAs3D">
      ğŸ’¾ ä¿å­˜3Då›¾
    </button>
    <button class="btn btn-primary" bindtap="sharePreview">
      ğŸ“¤ åˆ†äº«é¢„è§ˆ
    </button>
  </view>

  <!-- å¸®åŠ©æç¤º -->
  <view class="help-tip" wx:if="{{showHelp}}">
    <view class="tip-content">
      <text class="tip-text">ğŸ’¡ ç‚¹å‡»æˆ¿é—´æŸ¥çœ‹è¯¦æƒ…ï¼Œæ‹–æ‹½æ—‹è½¬æŸ¥çœ‹ä¸åŒè§’åº¦</text>
      <button class="tip-close" bindtap="closeHelp">çŸ¥é“äº†</button>
    </view>
  </view>
</view>