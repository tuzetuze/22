<view class="container">
  <!-- 3D预览头部 -->
  <view class="preview-header">
    <view class="header-content">
      <text class="preview-title">🏠 3D家居预览</text>
      <text class="preview-subtitle">沉浸式体验您的理想家居</text>
    </view>
    <view class="view-controls">
      <button class="control-btn {{viewMode === '3d' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="3d">
        <text class="control-icon">🎛️</text>
        <text class="control-text">3D视图</text>
      </button>
      <button class="control-btn {{viewMode === 'plan' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="plan">
        <text class="control-icon">📐</text>
        <text class="control-text">平面图</text>
      </button>
    </view>
  </view>

  <!-- 3D房屋模型区域 -->
  <view class="house-3d-container">
    <view class="house-model" style="transform: {{houseTransform}};">
      
      <!-- 房屋外框 -->
      <view class="house-frame">
        <view class="house-wall wall-front"></view>
        <view class="house-wall wall-back"></view>
        <view class="house-wall wall-left"></view>
        <view class="house-wall wall-right"></view>
        <view class="house-floor"></view>
        <view class="house-ceiling"></view>
      </view>

      <!-- 各个房间3D效果 -->
      <view class="rooms-3d">
        <view 
          class="room-3d {{item.completed ? 'completed' : 'pending'}}"
          wx:for="{{rooms3D}}"
          wx:key="id"
          style="{{item.position}}; {{item.size}};"
          bindtap="focusRoom"
          data-room="{{item.id}}"
        >
          <!-- 房间地板 -->
          <view class="room-floor" style="background: {{item.floorColor}};"></view>
          
          <!-- 房间墙面 -->
          <view class="room-walls">
            <view class="room-wall wall-front" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-back" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-left" style="background: {{item.wallColor}};"></view>
            <view class="room-wall wall-right" style="background: {{item.wallColor}};"></view>
          </view>

          <!-- 房间家具(简化3D效果) -->
          <view class="room-furniture">
            <view 
              class="furniture-item furniture-{{furnitureItem.type}}"
              wx:for="{{item.furniture}}"
              wx:key="id"
              wx:for-item="furnitureItem"
              style="{{furnitureItem.position}}; {{furnitureItem.style}};"
            >
              <text class="furniture-icon">{{furnitureItem.icon}}</text>
            </view>
          </view>

          <!-- 房间标签 -->
          <view class="room-label">
            <text class="room-name">{{item.name}}</text>
            <text class="room-status">{{item.completed ? '已规划' : '未规划'}}</text>
          </view>
        </view>
      </view>

      <!-- 房屋装饰效果 -->
      <view class="house-decorations">
        <!-- 窗户 -->
        <view class="window window-1"></view>
        <view class="window window-2"></view>
        <view class="window window-3"></view>
        
        <!-- 门 -->
        <view class="door main-door"></view>
      </view>
    </view>

    <!-- 3D控制面板 -->
    <view class="control-panel">
      <view class="rotation-controls">
        <button class="rotate-btn" bindtap="rotateHouse" data-direction="left">↻</button>
        <text class="control-label">旋转视角</text>
        <button class="rotate-btn" bindtap="rotateHouse" data-direction="right">↺</button>
      </view>
      <view class="zoom-controls">
        <button class="zoom-btn" bindtap="zoomHouse" data-action="out">−</button>
        <text class="control-label">缩放</text>
        <button class="zoom-btn" bindtap="zoomHouse" data-action="in">+</button>
      </view>
    </view>
  </view>

  <!-- 房间详情面板 -->
  <view class="room-details-panel" wx:if="{{selectedRoom}}">
    <view class="panel-header">
      <view class="room-info">
        <text class="room-icon">{{selectedRoom.icon}}</text>
        <view class="room-text">
          <text class="room-title">{{selectedRoom.name}}</text>
          <text class="room-desc">{{selectedRoom.description}}</text>
        </view>
      </view>
      <button class="close-btn" bindtap="closeRoomPanel">×</button>
    </view>
    
    <view class="panel-content">
      <!-- 房间预算 -->
      <view class="detail-item">
        <text class="detail-label">💰 预算</text>
        <text class="detail-value">￥{{selectedRoom.budget || 0}}</text>
      </view>
      
      <!-- 装修风格 -->
      <view class="detail-item" wx:if="{{selectedRoom.style}}">
        <text class="detail-label">🎨 风格</text>
        <text class="detail-value">{{selectedRoom.style}}</text>
      </view>
      
      <!-- 主要特色 -->
      <view class="detail-item" wx:if="{{selectedRoom.features && selectedRoom.features.length > 0}}">
        <text class="detail-label">✨ 特色</text>
        <view class="features-tags">
          <text 
            class="feature-tag"
            wx:for="{{selectedRoom.features}}"
            wx:key="*this"
          >{{item}}</text>
        </view>
      </view>

      <!-- 快速操作 -->
      <view class="quick-actions">
        <button class="action-btn" bindtap="editRoom" data-room="{{selectedRoom.id}}">
          <text class="action-icon">✏️</text>
          <text class="action-text">编辑</text>
        </button>
        <button class="action-btn" bindtap="viewRoomItems" data-room="{{selectedRoom.id}}">
          <text class="action-icon">📋</text>
          <text class="action-text">清单</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 整体统计 -->
  <view class="house-stats">
    <view class="stat-item">
      <text class="stat-label">总预算</text>
      <text class="stat-value">￥{{totalBudget}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">已规划</text>
      <text class="stat-value">{{completedRooms}}/{{totalRooms}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">完成度</text>
      <text class="stat-value">{{Math.round(completedRooms/totalRooms*100)}}%</text>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="preview-actions">
    <button class="btn btn-secondary" bindtap="generateReport">
      📊 生成报告
    </button>
    <button class="btn btn-secondary" bindtap="saveAs3D">
      💾 保存3D图
    </button>
    <button class="btn btn-primary" bindtap="sharePreview">
      📤 分享预览
    </button>
  </view>

  <!-- 帮助提示 -->
  <view class="help-tip" wx:if="{{showHelp}}">
    <view class="tip-content">
      <text class="tip-text">💡 点击房间查看详情，拖拽旋转查看不同角度</text>
      <button class="tip-close" bindtap="closeHelp">知道了</button>
    </view>
  </view>
</view>